version: "3.9"
services:
  ubvnc-odyssey-x86j4125-code:
    build: 
      context: ../
      dockerfile: ./common/code/Dockerfile
      args:
        - OPENWRT_VERSION=22.03.2
        # check https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem#debianubuntu for dependencies
        - >-
             PACKAGES_INSTALL=
             build-essential ccache ecj fastjar file g++ gawk
             gettext git java-propose-classpath libelf-dev libncurses5-dev
             libncursesw5-dev libssl-dev python python2.7-dev python3 unzip wget
             python3-distutils python3-setuptools python3-dev rsync subversion
             swig time xsltproc zlib1g-dev ssh
    ports:
      - "6080:80"
      - "5900:5900"
    volumes:
      - ./config:/root/openwrt_config
      - ./files:/root/openwrt_files
      - ./binaries/code:/root/Desktop/openwrt/bin/targets/x86
      - ./binaries/imagebuilder:/root/Desktop/openwrt-imagebuilder/bin/targets/x86
    entrypoint:
      - /bin/sh
      - -c
      - |
          sed -i 's/\r//g' /root/openwrt_files/etc/uci-defaults/99_increase-disk-size
          sed -i 's/\r//g' /root/openwrt_files/etc/uci-defaults/99_uci-config
          rm /root/Desktop/openwrt/.config
          ln -s /root/openwrt_config/config /root/Desktop/openwrt/.config
          ln -s -T /root/openwrt_files /root/Desktop/openwrt-imagebuilder/files
          cp -ru /root/Desktop/openwrt/.bin/targets/x86/64 /root/Desktop/openwrt/bin/targets/x86
          /startup.sh
    environment:
      # To use with the compiled image builder, can't use the one on openwrt binary repo since it contains a kernel that will not work
      # Check more info https://openwrt.org/docs/guide-user/additional-software/imagebuilder
      - >-
        PACKAGES=
        -libustream-wolfssl
        acl
        aircard-pcmcia-firmware
        amd64-microcode
        amdgpu-firmware
        antfs-mount
        ar3k-firmware
        ath10k-board-qca4019
        ath10k-board-qca9377
        ath10k-board-qca9887
        ath10k-board-qca9888
        ath10k-board-qca988x
        ath10k-board-qca9984
        ath10k-board-qca99x0
        ath10k-firmware-qca4019
        ath10k-firmware-qca6174
        ath10k-firmware-qca9377
        ath10k-firmware-qca9887
        ath10k-firmware-qca9888
        ath10k-firmware-qca988x
        ath10k-firmware-qca9984
        ath10k-firmware-qca99x0
        ath6k-firmware
        ath9k-htc-firmware
        attr
        b43legacy-firmware
        base-files
        bash
        block-mount
        blockd
        bnx2-firmware
        bnx2x-firmware
        brcmfmac-firmware-43602a1-pcie
        brcmfmac-firmware-4366b1-pcie
        brcmfmac-firmware-4366c0-pcie
        brcmfmac-firmware-usb
        bridge
        bsdtar
        btrfs-progs
        busybox
        bzip2
        ca-bundle
        ca-certificates
        carl9170-firmware
        cgi-io
        cypress-firmware-4356-pcie
        cypress-firmware-43570-pcie
        cypress-firmware-4373-usb
        cypress-firmware-54591-pcie
        dbus
        dnslookup
        dnsmasq-full
        dropbear
        e100-firmware
        e2fsprogs
        edgeport-firmware
        eip197-mini-firmware
        fdisk
        firewall4
        fstools
        fwtool
        getrandom
        grub2
        grub2-bios-setup
        grub2-efi
        gzip
        hostapd-common
        ibt-firmware
        intel-microcode
        ip6tables-nft
        iptables-mod-extra
        iptables-mod-ipopt
        iptables-nft
        iucode-tool
        iw
        iwinfo
        iwl3945-firmware
        iwl4965-firmware
        iwlwifi-firmware-ax200
        iwlwifi-firmware-ax210
        iwlwifi-firmware-iwl100
        iwlwifi-firmware-iwl1000
        iwlwifi-firmware-iwl105
        iwlwifi-firmware-iwl135
        iwlwifi-firmware-iwl2000
        iwlwifi-firmware-iwl2030
        iwlwifi-firmware-iwl3160
        iwlwifi-firmware-iwl3168
        iwlwifi-firmware-iwl5000
        iwlwifi-firmware-iwl5150
        iwlwifi-firmware-iwl6000g2
        iwlwifi-firmware-iwl6000g2a
        iwlwifi-firmware-iwl6000g2b
        iwlwifi-firmware-iwl6050
        iwlwifi-firmware-iwl7260
        iwlwifi-firmware-iwl7265
        iwlwifi-firmware-iwl7265d
        iwlwifi-firmware-iwl8260c
        iwlwifi-firmware-iwl8265
        iwlwifi-firmware-iwl9000
        iwlwifi-firmware-iwl9260
        jansson4
        jshn
        jsonfilter
        kernel
        kmod-3c59x
        kmod-8139cp
        kmod-8139too
        kmod-9pnet
        kmod-adm8211
        kmod-alx
        kmod-amazon-ena
        kmod-amd-xgbe
        kmod-aoe
        kmod-asn1-decoder
        kmod-ata-ahci
        kmod-ata-core
        kmod-ata-marvell-sata
        kmod-ata-nvidia-sata
        kmod-ata-piix
        kmod-ata-sil
        kmod-ata-sil24
        kmod-ata-via-sata
        kmod-ath
        kmod-ath6kl
        kmod-ath6kl-usb
        kmod-ath9k
        kmod-ath9k-common
        kmod-ath9k-htc
        kmod-atl1
        kmod-atl1c
        kmod-atl1e
        kmod-atl2
        kmod-atm
        kmod-b43
        kmod-b43legacy
        kmod-b44
        kmod-backlight
        kmod-backlight-pwm
        kmod-bcma
        kmod-be2net
        kmod-block2mtd
        kmod-bluetooth
        kmod-bnx2
        kmod-bnx2x
        kmod-bonding
        kmod-br-netfilter
        kmod-brcmfmac
        kmod-brcmsmac
        kmod-brcmutil
        kmod-button-hotplug
        kmod-carl9170
        kmod-cdrom
        kmod-cfg80211
        kmod-chaoskey
        kmod-crypto-acompress
        kmod-crypto-aead
        kmod-crypto-arc4
        kmod-crypto-authenc
        kmod-crypto-cbc
        kmod-crypto-ccm
        kmod-crypto-cmac
        kmod-crypto-crc32
        kmod-crypto-crc32c
        kmod-crypto-ctr
        kmod-crypto-cts
        kmod-crypto-deflate
        kmod-crypto-des
        kmod-crypto-ecb
        kmod-crypto-ecdh
        kmod-crypto-echainiv
        kmod-crypto-fcrypt
        kmod-crypto-gcm
        kmod-crypto-gf128
        kmod-crypto-ghash
        kmod-crypto-hash
        kmod-crypto-hmac
        kmod-crypto-kpp
        kmod-crypto-manager
        kmod-crypto-md4
        kmod-crypto-md5
        kmod-crypto-michael-mic
        kmod-crypto-null
        kmod-crypto-pcbc
        kmod-crypto-rng
        kmod-crypto-seqiv
        kmod-crypto-sha1
        kmod-crypto-sha256
        kmod-crypto-sha512
        kmod-dax
        kmod-dm
        kmod-dm9000
        kmod-dma-buf
        kmod-dnsresolver
        kmod-drm
        kmod-drm-amdgpu
        kmod-drm-kms-helper
        kmod-drm-radeon
        kmod-drm-ttm
        kmod-dummy
        kmod-e100
        kmod-e1000
        kmod-e1000e
        kmod-eeprom-93cx6
        kmod-et131x
        kmod-ethoc
        kmod-fb
        kmod-fb-cfb-copyarea
        kmod-fb-cfb-fillrect
        kmod-fb-cfb-imgblt
        kmod-fb-sys-fops
        kmod-fb-sys-ram
        kmod-fb-tft
        kmod-fb-tft-ili9486
        kmod-fixed-phy
        kmod-forcedeth
        kmod-fs-9p
        kmod-fs-antfs
        kmod-fs-autofs4
        kmod-fs-btrfs
        kmod-fs-cifs
        kmod-fs-configfs
        kmod-fs-cramfs
        kmod-fs-efivarfs
        kmod-fs-exfat
        kmod-fs-exportfs
        kmod-fs-ext4
        kmod-fs-f2fs
        kmod-fs-fscache
        kmod-fs-hfs
        kmod-fs-hfsplus
        kmod-fs-isofs
        kmod-fs-jfs
        kmod-fs-ksmbd
        kmod-fs-minix
        kmod-fs-msdos
        kmod-fs-nfs
        kmod-fs-nfs-common
        kmod-fs-nfs-common-rpcsec
        kmod-fs-nfs-v3
        kmod-fs-nfs-v4
        kmod-fs-nfsd
        kmod-fs-ntfs
        kmod-fs-reiserfs
        kmod-fs-squashfs
        kmod-fs-udf
        kmod-fs-vfat
        kmod-fs-xfs
        kmod-fuse
        kmod-gre
        kmod-gre6
        kmod-hermes
        kmod-hermes-pci
        kmod-hermes-plx
        kmod-hfcmulti
        kmod-hfcpci
        kmod-hid
        kmod-hid-generic
        kmod-hwmon-core
        kmod-i2c-algo-bit
        kmod-i2c-core
        kmod-i40e
        kmod-iavf
        kmod-ifb
        kmod-igb
        kmod-igbvf
        kmod-igc
        kmod-ikconfig
        kmod-input-core
        kmod-input-evdev
        kmod-iosched-bfq
        kmod-ip6-tunnel
        kmod-ip6tables
        kmod-ipsec
        kmod-ipt-conntrack
        kmod-ipt-conntrack-extra
        kmod-ipt-core
        kmod-ipt-extra
        kmod-ipt-ipopt
        kmod-ipt-ipset
        kmod-ipt-nat
        kmod-ipt-nat6
        kmod-ipt-physdev
        kmod-ipt-raw
        kmod-iptunnel
        kmod-iptunnel6
        kmod-ipvlan
        kmod-ipw2100
        kmod-ipw2200
        kmod-irqbypass
        kmod-iwl-legacy
        kmod-iwl3945
        kmod-iwl4965
        kmod-iwlwifi
        kmod-ixgbe
        kmod-ixgbevf
        kmod-keys-encrypted
        kmod-keys-trusted
        kmod-kvm-amd
        kmod-kvm-intel
        kmod-kvm-x86
        kmod-l2tp
        kmod-l2tp-eth
        kmod-l2tp-ip
        kmod-lib-cordic
        kmod-lib-crc-ccitt
        kmod-lib-crc-itu-t
        kmod-lib-crc16
        kmod-lib-crc32c
        kmod-lib-crc8
        kmod-lib-lzo
        kmod-lib-raid6
        kmod-lib-textsearch
        kmod-lib-xor
        kmod-lib-zlib-deflate
        kmod-lib-zlib-inflate
        kmod-lib-zstd
        kmod-lib80211
        kmod-libertas-usb
        kmod-libipw
        kmod-libphy
        kmod-libsas
        kmod-loop
        kmod-mac80211
        kmod-macvlan
        kmod-mdio
        kmod-mdio-devres
        kmod-mdio-gpio
        kmod-mii
        kmod-misdn
        kmod-mlx4-core
        kmod-mlx5-core
        kmod-mmc
        kmod-mppe
        kmod-mt76
        kmod-mt76-connac
        kmod-mt76-core
        kmod-mt76-sdio
        kmod-mt76-usb
        kmod-mt7601u
        kmod-mt7603
        kmod-mt7615-common
        kmod-mt7615-firmware
        kmod-mt7615e
        kmod-mt7663-firmware-ap
        kmod-mt7663-usb-sdio
        kmod-mt7663u
        kmod-mt76x0-common
        kmod-mt76x02-common
        kmod-mt76x02-usb
        kmod-mt76x0e
        kmod-mt76x0u
        kmod-mt76x2
        kmod-mt76x2-common
        kmod-mt76x2u
        kmod-mt7915e
        kmod-mt7921-common
        kmod-mt7921e
        kmod-mt7921s
        kmod-mt7921u
        kmod-mvsas
        kmod-mwl8k
        kmod-natsemi
        kmod-nbd
        kmod-ne2k-pci
        kmod-net-prism54
        kmod-nf-conntrack
        kmod-nf-conntrack-netlink
        kmod-nf-conntrack6
        kmod-nf-flow
        kmod-nf-ipt
        kmod-nf-ipt6
        kmod-nf-ipvs
        kmod-nf-log
        kmod-nf-log6
        kmod-nf-nat
        kmod-nf-nat6
        kmod-nf-nathelper
        kmod-nf-nathelper-extra
        kmod-nf-reject
        kmod-nf-reject6
        kmod-nfnetlink
        kmod-nft-bridge
        kmod-nft-compat
        kmod-nft-core
        kmod-nft-fib
        kmod-nft-nat
        kmod-nft-netdev
        kmod-nft-offload
        kmod-niu
        kmod-nls-base
        kmod-nls-cp437
        kmod-nls-iso8859-1
        kmod-nls-utf8
        kmod-oid-registry
        kmod-owl-loader
        kmod-p54-common
        kmod-p54-pci
        kmod-p54-usb
        kmod-pcnet32
        kmod-pcspkr
        kmod-phy-ax88796b
        kmod-phy-bcm84881
        kmod-phy-broadcom
        kmod-phy-microchip
        kmod-phy-realtek
        kmod-phy-smsc
        kmod-phylib-broadcom
        kmod-phylink
        kmod-ppp
        kmod-pppoa
        kmod-pppoe
        kmod-pppol2tp
        kmod-pppox
        kmod-pps
        kmod-pptp
        kmod-pstore
        kmod-ptp
        kmod-qlcnic
        kmod-r6040
        kmod-r8169
        kmod-random-core
        kmod-regmap-core
        kmod-rsi91x
        kmod-rsi91x-usb
        kmod-rt2400-pci
        kmod-rt2500-pci
        kmod-rt2500-usb
        kmod-rt2800-lib
        kmod-rt2800-mmio
        kmod-rt2800-pci
        kmod-rt2800-usb
        kmod-rt2x00-lib
        kmod-rt2x00-mmio
        kmod-rt2x00-pci
        kmod-rt2x00-usb
        kmod-rt61-pci
        kmod-rt73-usb
        kmod-rtl8180
        kmod-rtl8187
        kmod-rtl8192c-common
        kmod-rtl8192ce
        kmod-rtl8192cu
        kmod-rtl8192de
        kmod-rtl8192se
        kmod-rtl8812au-ct
        kmod-rtl8821ae
        kmod-rtlwifi
        kmod-rtlwifi-btcoexist
        kmod-rtlwifi-pci
        kmod-rtlwifi-usb
        kmod-rtw88
        kmod-sched-cake
        kmod-sched-core
        kmod-scsi-cdrom
        kmod-scsi-core
        kmod-scsi-generic
        kmod-sdhci
        kmod-sfc
        kmod-sfc-falcon
        kmod-sfp
        kmod-siit
        kmod-sis190
        kmod-sis900
        kmod-skge
        kmod-sky2
        kmod-slhc
        kmod-solos-pci
        kmod-sound-core
        kmod-spi-bitbang
        kmod-spi-ks8995
        kmod-ssb
        kmod-swconfig
        kmod-switch-bcm53xx
        kmod-switch-bcm53xx-mdio
        kmod-switch-ip17xx
        kmod-switch-rtl8306
        kmod-switch-rtl8366-smi
        kmod-switch-rtl8366rb
        kmod-switch-rtl8366s
        kmod-switch-rtl8367b
        kmod-tg3
        kmod-thermal
        kmod-tpm
        kmod-tulip
        kmod-udptunnel4
        kmod-udptunnel6
        kmod-usb-acm
        kmod-usb-atm
        kmod-usb-atm-cxacru
        kmod-usb-atm-speedtouch
        kmod-usb-atm-ueagle
        kmod-usb-cm109
        kmod-usb-core
        kmod-usb-dwc2
        kmod-usb-dwc3
        kmod-usb-ehci
        kmod-usb-hid
        kmod-usb-hid-cp2112
        kmod-usb-ledtrig-usbport
        kmod-usb-net
        kmod-usb-net-aqc111
        kmod-usb-net-asix
        kmod-usb-net-asix-ax88179
        kmod-usb-net-cdc-eem
        kmod-usb-net-cdc-ether
        kmod-usb-net-cdc-mbim
        kmod-usb-net-cdc-ncm
        kmod-usb-net-cdc-subset
        kmod-usb-net-dm9601-ether
        kmod-usb-net-hso
        kmod-usb-net-huawei-cdc-ncm
        kmod-usb-net-ipheth
        kmod-usb-net-kalmia
        kmod-usb-net-kaweth
        kmod-usb-net-lan78xx
        kmod-usb-net-mcs7830
        kmod-usb-net-pegasus
        kmod-usb-net-pl
        kmod-usb-net-qmi-wwan
        kmod-usb-net-rndis
        kmod-usb-net-rtl8150
        kmod-usb-net-rtl8152
        kmod-usb-net-sierrawireless
        kmod-usb-net-smsc75xx
        kmod-usb-net-smsc95xx
        kmod-usb-net-sr9700
        kmod-usb-ohci
        kmod-usb-ohci-pci
        kmod-usb-printer
        kmod-usb-roles
        kmod-usb-serial
        kmod-usb-serial-ark3116
        kmod-usb-serial-belkin
        kmod-usb-serial-ch341
        kmod-usb-serial-cp210x
        kmod-usb-serial-cypress-m8
        kmod-usb-serial-dmx_usb_module
        kmod-usb-serial-edgeport
        kmod-usb-serial-ftdi
        kmod-usb-serial-garmin
        kmod-usb-serial-ipw
        kmod-usb-serial-keyspan
        kmod-usb-serial-mct
        kmod-usb-serial-mos7720
        kmod-usb-serial-mos7840
        kmod-usb-serial-option
        kmod-usb-serial-oti6858
        kmod-usb-serial-pl2303
        kmod-usb-serial-qualcomm
        kmod-usb-serial-sierrawireless
        kmod-usb-serial-simple
        kmod-usb-serial-ti-usb
        kmod-usb-serial-visor
        kmod-usb-serial-wwan
        kmod-usb-serial-xr_usb_serial_common
        kmod-usb-storage
        kmod-usb-storage-extras
        kmod-usb-storage-uas
        kmod-usb-uhci
        kmod-usb-wdm
        kmod-usb-xhci-hcd
        kmod-usb-yealink
        kmod-usb2
        kmod-usb2-pci
        kmod-usb3
        kmod-usbip
        kmod-usbip-client
        kmod-usbip-server
        kmod-usbmon
        kmod-v4l2loopback
        kmod-veth
        kmod-via-rhine
        kmod-via-velocity
        kmod-video-core
        kmod-video-cpia2
        kmod-video-gspca-conex
        kmod-video-gspca-core
        kmod-video-gspca-etoms
        kmod-video-gspca-finepix
        kmod-video-gspca-gl860
        kmod-video-gspca-jeilinj
        kmod-video-gspca-konica
        kmod-video-gspca-m5602
        kmod-video-gspca-mars
        kmod-video-gspca-mr97310a
        kmod-video-gspca-ov519
        kmod-video-gspca-ov534
        kmod-video-gspca-ov534-9
        kmod-video-gspca-pac207
        kmod-video-gspca-pac7311
        kmod-video-gspca-se401
        kmod-video-gspca-sn9c20x
        kmod-video-gspca-sonixb
        kmod-video-gspca-sonixj
        kmod-video-gspca-spca500
        kmod-video-gspca-spca501
        kmod-video-gspca-spca505
        kmod-video-gspca-spca506
        kmod-video-gspca-spca508
        kmod-video-gspca-spca561
        kmod-video-gspca-sq905
        kmod-video-gspca-sq905c
        kmod-video-gspca-sq930x
        kmod-video-gspca-stk014
        kmod-video-gspca-stv06xx
        kmod-video-gspca-sunplus
        kmod-video-gspca-t613
        kmod-video-gspca-tv8532
        kmod-video-gspca-vc032x
        kmod-video-gspca-zc3xx
        kmod-video-pwc
        kmod-video-uvc
        kmod-video-videobuf2
        kmod-vmxnet3
        kmod-vxlan
        kmod-wil6210
        kmod-wl12xx
        kmod-wl18xx
        kmod-wlcore
        kmod-zd1211rw
        libacl
        libarchive
        libatomic1
        libattr
        libavahi-dbus-support
        libblkid1
        libblobmsg-json20220515
        libbz2-1.0
        libc
        libcap
        libcomerr0
        libdaemon
        libdbus
        libdevmapper
        libertas-usb-firmware
        libevent2-core7
        libexpat
        libext2fs2
        libfdisk1
        libgcc1
        libgmp10
        libgnutls
        libiconv-full2
        libiptext-nft0
        libiptext0
        libiptext6-0
        libiwinfo-data
        libiwinfo-lua
        libiwinfo20210430
        libjson-c5
        libjson-script20220515
        liblua5.1.5
        liblucihttp-lua
        liblucihttp0
        liblz4-1
        liblzma
        liblzo2
        libmnl0
        libmount1
        libncurses6
        libnetfilter-conntrack3
        libnettle8
        libnfnetlink0
        libnftnl11
        libnl-tiny1
        libopenssl-conf
        libopenssl1.1
        libparted
        libpthread
        libreadline8
        librt
        libsmartcols1
        libss2
        libstdcpp6
        libtirpc
        libubox20220515
        libubus-lua
        libubus20220601
        libuci20130104
        libuclient20201210
        libucode20220812
        libuuid1
        libuv1
        libwebsockets-full
        libwrap
        libxml2
        libxtables12
        libzip-gnutls
        libzstd
        logd
        lsblk
        lua
        luci
        luci-app-firewall
        luci-app-opkg
        luci-app-ttyd
        luci-base
        luci-i18n-base-en
        luci-i18n-firewall-en
        luci-i18n-opkg-en
        luci-i18n-ttyd-en
        luci-lib-base
        luci-lib-ip
        luci-lib-jsonc
        luci-lib-nixio
        luci-mod-admin-full
        luci-mod-network
        luci-mod-status
        luci-mod-system
        luci-proto-ipv6
        luci-proto-ppp
        luci-theme-bootstrap
        luci-theme-material
        luci-theme-openwrt
        luci-theme-openwrt-2020
        lz4
        lzmadec
        lzmainfo
        mount-utils
        mt7601u-firmware
        mt7622bt-firmware
        mtd
        musl-fts
        mwl8k-firmware
        nano-full
        netifd
        nftables-json
        ntpclient
        openwrt-keyring
        opkg
        p54-pci-firmware
        p54-usb-firmware
        parted
        partx-utils
        pigz
        prism54-firmware
        procd
        procd-seccomp
        procd-ujail
        r8152-firmware
        r8169-firmware
        radeon-firmware
        resolveip
        rpcd
        rpcd-mod-file
        rpcd-mod-iwinfo
        rpcd-mod-luci
        rpcd-mod-rpcsys
        rpcd-mod-rrdns
        rpcd-mod-ucode
        rs9113-firmware
        rt2800-pci-firmware
        rt2800-usb-firmware
        rt61-pci-firmware
        rt73-usb-firmware
        rtl8188eu-firmware
        rtl8192ce-firmware
        rtl8192cu-firmware
        rtl8192de-firmware
        rtl8192eu-firmware
        rtl8192se-firmware
        rtl8723au-firmware
        rtl8723bu-firmware
        rtl8821ae-firmware
        rtl8822be-firmware
        rtl8822ce-firmware
        screen
        sqm-scripts
        tc-tiny
        terminfo
        ti-3410-firmware
        ti-5052-firmware
        tmux
        ttyd
        ubox
        ubus
        ubusd
        uci
        uclient-fetch
        ucode
        ucode-mod-fs
        ucode-mod-ubus
        ucode-mod-uci
        uhttpd
        uhttpd-mod-ubus
        unrar
        unzip
        urandom-seed
        urngd
        usign
        uxc
        wil6210-firmware
        wireless-regdb
        wl12xx-firmware
        wl18xx-firmware
        xtables-nft
        xz
        xz-utils
        xzdec
        xzdiff
        xzgrep
        xzless
        xzmore
        zipcmp
        zipmerge
        ziptool
        zlib
        zstd
